<!DOCTYPE html>
{% extends 'Header_Aside_Template.html' %}
{% load static %}

{% block extraCSS %} <link rel="stylesheet" type="text/css" href="{% static 'css/films_tooltip.css' %}"> {% endblock %}

{% block posts %}

    <input id="ajax" type="submit" value="AJAX" />
    <div id="ez">

    </div>
{% endblock %}

{% block scripts %}
    <script src="{% static 'js/jquery-2.1.3.min.js' %}"></script>
    <script>
        function getComments(pk, post)
        {
            $.ajax(
            {
                type: 'POST',
                url: '/ajax/comments/' + pk,
                data: JSON.stringify(),
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                success: function(response)
                {
                    for(var i in response)
                    {
                        console.log(response[i])
                        console.log('LOL')
                    }

                    for(var i in response)
                    {
                        comment = response[i].fields;

                        $('.post_comments', post).html('<div class="post_comment_div">' +
                        '<a href="profile/' + comment.user[0] +'" title="' + comment.user[1] + '"><img src="' + comment.user[2] + '" class="left_img post_cm_img"></a>' +
                        '<p><a href="profile/' + comment.user[0] + '">' + comment.user[1] + '</a></p>'+
                        '<p>' + comment.body + '</p>' +
                        '</div>' +
                        '<hr>');
                    }
                    return response
                }
            })
        }

        function showPost(response)
        {
            var x = document.createElement('div')
            x.className = 'post'
            var user = response.fields.user
            var post = response.fields
            var film = response.fields.film
            getComments(response.pk, x)

            x.innerHTML ='<div class="post_header">' +
            '<a href="profile' + '/' + user[0] + '"><img src="' + user[2] + '" title="' + user[1] + '" class="left_img"></a>' +
            '<p> <a href="profile/' + user[0] + '">' + user[1] + '</a> </p>' +
            '<a href="post/' + user[0] + '/' + response.pk + '" class="post_time">' + post.pubDate + '</a>' +
            '</div> <hr>'

            x.innerHTML += '<div class="post_body">' +
            '<a href="" title="' + film[0] + '"><img src="' + film[1] + '" class="right_img"></a>' +
            '<a href="movieProfile/' + film[0] + '" class="inline_block"><h1>' + film[0] + '</h1></a>' +
            '<div class="tooltip" style="display: none;">' +
            '<div class="suggested_movie box-inner">' +
            '<a href=""><img src="' + film[1] + '" title="' + film[0] + '" class="left_img suggested_movie_img"></a>' +
            '<a href=""><h2>' + film[0] + '</h2></a>' +
{#            <p> Director(s):#}
{#                {% for cast in post.film.cast_set.all%}#}
{#                    {% if cast.roleName == 'Director' %}#}
{#                        {{ cast.name }}#}
{#                    {% endif %}#}
{##}
{#                    {% if not forloop.last %} , {% endif %}#}
{#                {% endfor %}#}
{#            </p>#}
            '<img src="/static/img/rate_10.png"><br>' +
            '<a href="" class="suggested_movie_imdb"><img src="/static/img/IMDB.png"></a>' +
            '</div>' +
            '</div>' +
            '<img src="/static/img/rate_10.png" class="rate_img">' +
            '<div class="post_content">' +
            '<p>' +
            post.body +
            '</p>' +
            '</div>' +
            '</div> <hr>' +
            '<div>' +
            '<img src="/static/img/like.png">' +
            '<span>' + post.likeUsers.length + '</span>' +
            '<img src="/static/img/cm2.png">' +
            '<span> 111 </span>' +
            '</div>' +
            '<hr>' +
            '<div class="post_comments">';

            x.innerHTML += '</div>' +
            '<div class="post_incm">' +
            '<a href="" title="' + user[1] + '"><img src="' + user[2] + '" class="left_img"></a>' +
            '<form>' +
            '<input type="text" name="comment" value="" placeholder="Comment" class="cm_input">' +
            '<input type="submit" name="commit" value=" " class="cm_button">' +
            '</form>' +
            '</div>'

            $('#ez').append(x)

            $('.tooltip').prev().mouseover(function(){

                $(this).next().css('display' , 'block');
            });

            $('.tooltip').prev().mouseout(function(){
                $(this).next().css('display' , 'none');
            });
        }

        $('#ajax').on('click', function()
        {
            $.ajax(
            {
                type: 'POST',
                url: '/ajax',
                data: JSON.stringify(),
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                success: function(response)
                {
                    for(var i in response)
                    {
                        showPost(response[i])
                        console.log(response[i])
                    }
                }
            })
        });

    </script>

    <script src="{% static "js/setAsidePosition.js" %}"></script>
    <script src="{% static "js/addCommentToPosts.js" %}"></script>
    <script src="{% static "js/showNotif.js" %}"></script>
    <script src="{% static "js/showTooltip.js" %}"></script>
    <script src="{% static "js/search.js" %}"></script>
{% endblock %}
